<!DOCTYPE html>
<html lang="en-us">

  {% include head.html %}

  <body class="{% if page.layout == 'post' %}post-page{% endif %}">

    {% include sidebar.html %}

    <!-- Wrap is the content to shift when toggling the sidebar. We wrap the
         content to avoid any CSS collisions with our real content. -->
    <div class="wrap">
      <div class="masthead">
        <div class="container">
          <h3 class="masthead-title">
            <a href="{{ site.baseurl }}/" title="Home">{{ site.title }}</a>
            <small>{{ site.tagline }}</small>
          </h3>
        </div>
      </div>

      <div class="container content">
        {{ content }}
      </div>
    </div>

    <label for="sidebar-checkbox" class="sidebar-toggle"></label>

    <script src='{{ site.baseurl }}/public/js/script.js'></script>
     <!-- æ–°å¢žï¼šå¼•å…¥ Mermaid JS + æ¸²æŸ“è„šæœ¬ï¼ˆæ”¾åœ¨ </body> å‰ï¼‰ -->
  <!-- Mermaid æ ¸å¿ƒåº“ï¼ˆç¨³å®šç‰ˆ CDNï¼‰ -->
  <script src="https://cdn.jsdelivr.net/npm/mermaid@10.9.1/dist/mermaid.min.js"></script>
  <!-- åˆå§‹åŒ– Mermaid + è¯†åˆ«ä»£ç å— -->
  <script>
    // é…ç½® Mermaid æ¸²æŸ“æ ·å¼ï¼ˆé€‚é… Lanyon æžç®€é£Žæ ¼ï¼‰
    mermaid.initialize({
      theme: 'neutral', // ä¸­æ€§ä¸»é¢˜ï¼ŒåŒ¹é… Lanyon é»‘ç™½ç°é£Žæ ¼
      themeVariables: {
        primaryColor: '#f5f5f5',
        borderColor: '#eee',
        textColor: '#333'
      },
      startOnLoad: false, // æ‰‹åŠ¨è§¦å‘æ¸²æŸ“ï¼Œé¿å…å†²çª
      securityLevel: 'loose' // å…è®¸è‡ªå®šä¹‰æ ·å¼
    });

    // è¯†åˆ«æ‰€æœ‰ ```mermaid ä»£ç å—ï¼Œæ›¿æ¢ä¸º Mermaid å®¹å™¨å¹¶æ¸²æŸ“
    document.addEventListener('DOMContentLoaded', function() {
      // æ‰¾åˆ°æ‰€æœ‰ mermaid ä»£ç å—
      const mermaidBlocks = document.querySelectorAll('pre code.language-mermaid');
      mermaidBlocks.forEach(block => {
        // èŽ·å–ä»£ç å†…å®¹
        const mermaidCode = block.textContent.trim();
        // åˆ›å»º Mermaid å®¹å™¨
        const mermaidDiv = document.createElement('div');
        mermaidDiv.className = 'mermaid';
        mermaidDiv.textContent = mermaidCode;
        // æ›¿æ¢åŽŸä»£ç å—
        block.parentElement.replaceWith(mermaidDiv);
      });
      // æ¸²æŸ“æ‰€æœ‰ Mermaid å®¹å™¨
      mermaid.run();
    });
      // ç›®å½•æ»šåŠ¨é«˜äº®
  document.addEventListener('DOMContentLoaded', function() {
    (function buildTOC(){
      const tocRoot = document.getElementById('toc');
      const contentEl = document.querySelector('.post-content');
      if (!tocRoot || !contentEl) return;
      const headings = contentEl.querySelectorAll('h2, h3, h4, h5, h6');
      if (!headings.length) return;
      const container = document.createElement('div');
      container.className = 'toc-container';
      const title = document.createElement('h3');
      title.className = 'toc-title';
      title.textContent = 'ðŸ“‹ æ–‡ç« ç›®å½•';
      const list = document.createElement('ul');
      list.className = 'toc-list';
      const slugify = (text) => text
        .trim()
        .toLowerCase()
        .replace(/\s+/g, '-')
        .replace(/[^\w\-\u4e00-\u9fa5]/g, '-')
        .replace(/-+/g, '-')
        .replace(/^-|-$/g, '');
      headings.forEach(h => {
        const level = Number(h.tagName.slice(1));
        const text = h.textContent.trim();
        if (!text) return;
        if (!h.id) h.id = slugify(text) || ('h' + Math.random().toString(36).slice(2));
        const li = document.createElement('li');
        li.className = `toc-item toc-level-${level}`;
        const a = document.createElement('a');
        a.className = 'toc-link';
        a.href = `#${h.id}`;
        a.textContent = text;
        li.appendChild(a);
        list.appendChild(li);
      });
      container.appendChild(title);
      container.appendChild(list);
      tocRoot.replaceWith(container);
    })();

    const tocLinks = document.querySelectorAll('.toc-link');
    const headings = document.querySelectorAll('.post-content h2, .post-content h3, .post-content h4, .post-content h5, .post-content h6');

    // ç›‘å¬æ»šåŠ¨äº‹ä»¶
    window.addEventListener('scroll', function() {
      let currentHeading = '';
      // æ‰¾åˆ°å½“å‰å¯è§†åŒºåŸŸçš„æ ‡é¢˜
      headings.forEach(heading => {
        const rect = heading.getBoundingClientRect();
        if (rect.top <= 100 && rect.bottom >= 0) {
          currentHeading = heading.getAttribute('id');
        }
      });

      // é«˜äº®å½“å‰æ ‡é¢˜çš„ç›®å½•é“¾æŽ¥
      tocLinks.forEach(link => {
        link.classList.remove('active');
        if (link.getAttribute('href') === `#${currentHeading}`) {
          link.classList.add('active');
        }
      });
    });

    tocLinks.forEach(link => {
      link.addEventListener('click', function(e) {
        e.preventDefault();
        const targetId = this.getAttribute('href').slice(1);
        const target = document.getElementById(targetId);
        if (target) {
          target.scrollIntoView({
            behavior: 'smooth',
            block: 'start'
          });
        }
      });
    });
  });
  </script>
  </body>
</html>
